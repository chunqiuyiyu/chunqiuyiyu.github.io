{"version":3,"sources":["utils.js"],"names":["window","onload","searchFunc","path","search_id","content_id","BTN","$input","document","getElementById","$resultContent","innerHTML","xhr","XMLHttpRequest","open","send","onreadystatechange","readyState","status","xml","responseXML","root","documentElement","list","getElementsByTagName","datas","i","length","item","push","title","content","url","addEventListener","str","keywords","value","trim","toLowerCase","split","forEach","data","isMatch","content_index","orig_data_title","data_title","orig_data_content","replace","data_content","data_url","index_title","index_content","first_occur","keyword","indexOf","start","end","match_content","substr","regS","RegExp","btnClose","querySelector","inputArea","onclick","getSearchFile","onkeydown","event","keyCode","getElementsByClassName","script","createElement","id","src","asyc","parent","body","appendChild","HashOver","hashover","d","dd","db","top","scrollTop","step","Math","floor","setTimeout","arguments","callee"],"mappings":"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","file":"utils.map","sourceRoot":"..\\public\\js","sourcesContent":["window.onload = function() {\n    var searchFunc = function(path, search_id, content_id) {\n        // 0x00. environment initialization\n        'use strict';\n        var BTN = \"<div id='local-search-close'>清空搜索</div>\";\n        var $input = document.getElementById(search_id);\n        var $resultContent = document.getElementById(content_id);\n        $resultContent.innerHTML = BTN + \"<ul><span class='local-search-empty'>首次搜索，需载入索引文件，请稍候<span></ul>\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", path, true);\n        xhr.send();\n        xhr.onreadystatechange = function() {\n            if (xhr.readyState === 4 && xhr.status === 200) {\n                var xml = xhr.responseXML;\n                var root = xml.documentElement;\n                var list = root.getElementsByTagName(\"entry\");\n                var datas = [];\n                for (var i = list.length - 1; i >= 0; i--) {\n                    var item = list[i];\n                    datas.push({\n                        title: item.getElementsByTagName(\"title\")[0].innerHTML,\n                        content: item.getElementsByTagName(\"content\")[0].innerHTML,\n                        url: item.getElementsByTagName(\"url\")[0].innerHTML\n                    });\n                }\n                $input.addEventListener('input', function() {\n                    // 0x03. parse query to keywords list\n                    var str = '<ul class=\\\"search-result-list\\\">';\n                    var keywords = this.value.trim().toLowerCase().split(/[\\s\\-]+/);\n                    $resultContent.innerHTML = \"\";\n                    if (this.value.trim().length <= 0) {\n                        return;\n                    }\n\n                    // 0x04. perform local searching\n                    datas.forEach(function(data) {\n                        var isMatch = true;\n                        var content_index = [];\n                        if (!data.title || data.title.trim() === '') {\n                            data.title = \"Untitled\";\n                        }\n                        var orig_data_title = data.title.trim();\n                        var data_title = orig_data_title.toLowerCase();\n                        var orig_data_content = data.content.trim().replace(/<[^>]+>/g, \"\");\n                        var data_content = orig_data_content.toLowerCase();\n                        var data_url = data.url;\n                        var index_title = -1;\n                        var index_content = -1;\n                        var first_occur = -1;\n                        // only match artiles with not empty contents\n                        if (data_content !== '') {\n                            keywords.forEach(function(keyword, i) {\n                                index_title = data_title.indexOf(keyword);\n                                index_content = data_content.indexOf(keyword);\n\n                                if (index_title < 0 && index_content < 0) {\n                                    isMatch = false;\n                                } else {\n                                    if (index_content < 0) {\n                                        index_content = 0;\n                                    }\n                                    if (i == 0) {\n                                        first_occur = index_content;\n                                    }\n                                    // content_index.push({index_content:index_content, keyword_len:keyword_len});\n                                }\n                            });\n                        } else {\n                            isMatch = false;\n                        }\n                        // 0x05. show search results\n                        if (isMatch) {\n                            str += \"<li><a href='\" + data_url + \"' class='search-result-title'>\" + orig_data_title + \"</a>\";\n                            var content = orig_data_content;\n                            if (first_occur >= 0) {\n                                // cut out 100 characters\n                                var start = first_occur - 10;\n                                var end = first_occur + 30;\n\n                                if (start < 0) {\n                                    start = 0;\n                                }\n\n                                if (start == 0) {\n                                    end = 40;\n                                }\n\n                                if (end > content.length) {\n                                    end = content.length;\n                                }\n\n                                // console.log(content)\n                                var match_content = content.substr(start, 100);\n\n                                // highlight all keywords\n                                keywords.forEach(function(keyword) {\n                                    var regS = new RegExp(keyword, \"gi\");\n                                    match_content = match_content.replace(regS, \"<em class=\\\"search-keyword\\\">\" + keyword + \"</em>\");\n                                });\n\n                                str += \"<p class=\\\"search-result\\\">\" + match_content + \"...</p>\"\n                            }\n                            str += \"</li>\";\n                        }\n                    });\n                    str += \"</ul>\";\n                    if (str.indexOf('<li>') === -1) {\n                        return $resultContent.innerHTML = BTN + \"<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词<span></ul>\";\n                    }\n                    $resultContent.innerHTML = BTN + str;\n                });\n            }\n        };\n\n        // clear search result\n        var btnClose = document.querySelector(\"#local-search-close\");\n        btnClose.addEventListener('click', function() {\n            inputArea.value = '';\n            $resultContent.innerHTML = '';\n        });\n    }\n\n    var inputArea = document.querySelector(\"#local-search-input\");\n    if (inputArea) {\n        inputArea.onclick = function() {\n            getSearchFile();\n            this.onclick = null\n        }\n        inputArea.onkeydown = function() { if (event.keyCode == 13) return false }\n    }\n\n\n    var getSearchFile = function() {\n        var path = \"/search.xml\";\n        searchFunc(path, 'local-search-input', 'local-search-result');\n    }\n\n    // Load comment\n    if (!document.getElementById('hashoverScript') && document.getElementsByClassName('load')[0]) {\n        var script = document.createElement('script');\n        script.id = 'hashoverScript';\n        script.src = 'http://www.chunqiuyiyu.com/hashover/comments.php';\n        script.asyc = true;\n\n        var parent = document.getElementsByClassName('page')[0] ||\n            document.getElementsByClassName('post')[0] || document.body;\n        parent.appendChild(script);\n    }\n\n    document.getElementsByClassName('load')[0] && document.getElementsByClassName('load')[0].addEventListener('click', function() {\n        if (HashOver) var hashover = new HashOver();\n    });\n\n    // Go top\n    document.getElementsByClassName('top')[0] && document.getElementsByClassName('top')[0].addEventListener('click', function() {\n        var d = document,\n            dd = document.documentElement,\n            db = document.body,\n            top = dd.scrollTop || db.scrollTop,\n            step = Math.floor(top / 10);\n\n        (function() {\n            top -= step;\n            if (top > -step) {\n                dd.scrollTop == 0 ? db.scrollTop = top : dd.scrollTop = top;\n                setTimeout(arguments.callee, 10);\n            }\n        })();\n    });\n}"]}